data = readSalesFigures();x = data.Days(4:end-1)';y = data.Lettuce(4:end-1);maxTemp = data.MaxTemp(4:end-1);% Transform the data into a matrix who's rows are periodsdatesPeriods = reshape(x, 7, [])';salesPeriods = reshape(y, 7, [])';tempPeriods = reshape(maxTemp, 7, [])';periodSlopes = [];for periodIndex = 1:size(datesPeriods, 1)  datesPeriod = datesPeriods(periodIndex, :);  salesPeriod = salesPeriods(periodIndex, :);    % Ignore the zero sales data  validIndexes = find(salesPeriod > 0);    [slope, intercept] = slopeAndIntercept(datesPeriod(validIndexes), ...                                         salesPeriod(validIndexes));                                           periodSlopes(periodIndex) = slope;end% Remove slopes that are outliersoutlierIndexes = findOutliers(periodSlopes);datesPeriods(outlierIndexes, :) = [];salesPeriods(outlierIndexes, :) = [];tempPeriods(outlierIndexes, :) = [];slopeAvg = mean(periodSlopes);% Each sales data point transformed based on the slope and the average of% its periodfilteredTemps = [];filteredDates = []'transformedSales = [];for periodIndex = 1:size(datesPeriods, 1)    salesPeriod = salesPeriods(periodIndex, :);  tempPeriod = tempPeriods(periodIndex, :);  validIndexes = intersect(find(salesPeriod > 0), find(tempPeriod >= 10));   if length(validIndexes) == 0    continue;  end    datesPeriod = datesPeriods(periodIndex, :)(validIndexes);  salesPeriod = salesPeriod(validIndexes);  tempPeriod = tempPeriod(validIndexes);    intercept = mean(salesPeriod) - mean(datesPeriod) * slopeAvg;  deltaSales = salesPeriod - (slopeAvg .* datesPeriod + intercept) + mean(salesPeriod);  filteredDates = [filteredDates datesPeriod];  filteredTemps = [filteredTemps tempPeriod];  transformedSales = [transformedSales deltaSales];endcorrcoef(filteredDates, transformedSales)##plot(x, y, "b*", filteredDates, transformedSales, "r*");xlim([0 80]);ylim([600 1200]);##figure(2);plot(filteredTemps, transformedSales, "b*");####hold on;##